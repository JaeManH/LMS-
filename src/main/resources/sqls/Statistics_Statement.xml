<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org/DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.StatisticsDaoImpl">
    <!--  자동완성을 위한 과목코드 가져오는 쿼리  -->
    <select id="selectSubjectCode" resultType="java.lang.String">
        SELECT JSON_ARRAYAGG(JSON_OBJECT('label' VALUE COD_NAME, 'value' VALUE COD_CODE))
        FROM SUB_CODE sc
    </select>
    <!--  회원의 선호조사 또는 추천 결과를 업데이트 하는 쿼리  -->
    <!--  알고리즘으로 유사도가 높은 것들을 사용자의 추천리스트에 업데이트  -->
    <update id="updatePrefer" parameterType="java.util.Map">
        UPDATE TRAINEE
        SET TRA_PREFER = #{prefer}
        WHERE TRA_ID = #{id}
    </update>
    <!--  지정 사용자의 선호조사, 추천 리스트를 가져오는 쿼리  -->
    <select id="selectPreferW" parameterType="java.lang.String" resultType="java.lang.String">
        SELECT JSON_QUERY(TRA_PREFER, '$' RETURNING VARCHAR2)
        FROM TRAINEE
        WHERE TRA_ID = #{id}

    </select>
    <!--  전체 사용자의 선호조사, 추천 리스트를 가져오는 쿼리  -->
    <select id="selectPreferAll" resultType="java.lang.String">

        SELECT JSON_QUERY(TRA_PREFER, '$' RETURNING VARCHAR2)
        FROM TRAINEE
    </select>
    <!--  유사도 판별을 위해 선호도의 정보를 가져온다. (시작날짜, 총 수강 시간 , 태그명)   -->

    <!--    사용자 좋아요 업데이트-->
    <update id="updateUserLike" parameterType="java.util.Map">

        UPDATE TRAINEE
        SET TRA_LIKE = #{like}
        WHERE TRA_ID = #{id}
    </update>
    <!--    과정 좋아요 업데이트-->
    <update id="updateClassLike" parameterType="java.util.Map">

        UPDATE CLASS
        SET CLA_LIKE = #{like}
        WHERE CLA_NUM = #{num}
    </update>
    <!--    사용자 좋아요 목록-->
    <select id="selectUserLike" parameterType="java.lang.String" resultType="java.lang.String">

        SELECT JSON_QUERY(TRA_LIKE, '$' RETURNING VARCHAR2)
        FROM TRAINEE
        WHERE TRA_ID = #{id}
    </select>
    <!--    과정 좋아요 목록-->
    <select id="selectClassLike" parameterType="java.lang.String" resultType="java.lang.String">

        SELECT JSON_QUERY(CLA_LIKE, '$' RETURNING VARCHAR2)
        FROM CLASS
        WHERE CLA_NUM = #{num}
    </select>
</mapper>
