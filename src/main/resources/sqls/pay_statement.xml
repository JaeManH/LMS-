<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.min.daoImpl.PayDaoImpl">

	<!-- 관리자 결제 전체조회 -->
	<select id="paySelectAll" resultType="PayVo">
		SELECT PAY_NUM,
		PAY_TRA_BUYER,
		PAY_CLA_NUM, 
		PAY_PRICE, 
		PAY_METHOD, 
		PAY_PG, 
		PAY_STATUS, 
		PAY_DATE, 
		PAY_CONTENT, 
		PAY_RAW, 
		PAY_DISCOUNT, 
		PAY_CANDATE,
		PAY_CANCATE, 
		PAY_CANCONTENT, 
		PAY_UCOUNUM, 
		PAY_UMILAGE
		FROM PAY
		ORDER BY PAY_DATE DESC
	</select>
	
	<!-- 관리자 전체조회 페이지 상태변경시 쿼리 -->
	<select id="paySelectStatus" resultType="PayVo">
		SELECT PAY_NUM,
		PAY_TRA_BUYER,
		PAY_CLA_NUM, 
		PAY_PRICE, 
		PAY_METHOD, 
		PAY_PG, 
		PAY_STATUS, 
		PAY_DATE, 
		PAY_CONTENT, 
		PAY_RAW, 
		PAY_DISCOUNT, 
		PAY_CANDATE,
		PAY_CANCATE, 
		PAY_CANCONTENT, 
		PAY_UCOUNUM, 
		PAY_UMILAGE
		FROM PAY
		WHERE PAY_STATUS=#{pay_status}
		ORDER BY PAY_DATE DESC
	</select>
	
	<!-- 결제 -->
	<insert id="payInsert" parameterType="java.util.Map">
		INSERT INTO PAY
		(PAY_NUM,
		 PAY_TRA_BUYER,
		 PAY_CLA_NUM,
		 PAY_PRICE, 
		 PAY_METHOD, 
		 PAY_PG, 
		 PAY_STATUS, 
		 PAY_DATE, 
		 PAY_CONTENT, 
		 PAY_RAW, 
		 PAY_DISCOUNT, 
		 PAY_CANDATE, 
		 PAY_CANCATE, 
		 PAY_CANCONTENT, 
		 PAY_UCOUNUM, 
		 PAY_UMILAGE)
		VALUES(#{pay_num},
		 #{pay_tra_buyer},
		 #{pay_cla_num},
		 #{pay_price},
		 #{pay_method},
		 #{pay_pg},
		 #{pay_status},
		 #{pay_date},
		 #{pay_content},
		 #{pay_raw},
		 #{pay_discount},
		 #{pay_candate},
		 #{pay_cancate}, 
		 #{pay_cancontent},
		 #{pay_ucounum},
		 #{pay_umilage})
	</insert>
	
	<!-- 보유쿠폰 조회/ 결제시 사용가능 쿠폰 조회/ delflag Y일시 사용가능-->
	<select id="couponSelect" parameterType="java.util.Map" resultType="CouponVo">
	SELECT COU_CODE,
	 COU_TRA_ID,
	 COU_NAME,
	 COU_PER, 
	 COU_DELFLAG, 
	 COU_DATE
	 FROM COUPON WHERE COU_TRA_ID =#{cou_tra_id}
	</select>
	
	<!-- 쿠폰 지급 -->
	<insert id="couponInsert" parameterType="java.util.Map">
	INSERT INTO COUPON
	(COU_CODE,
	 COU_TRA_ID,
	 COU_NAME,
	 COU_PER,
	 COU_DELFLAG,
	 COU_DATE)
	VALUES(TO_CHAR(SYSDATE,'YYYYMMDD')||'_'||10||'_C'||LPAD(COU_SEQ.NEXTVAL,3,'0'),
	'thdwndrl1234',
	'그냥주는쿠폰',
	10,
	'Y',
	SYSDATE);
	</insert>
	
	<!-- 쿠폰사용 결제시 보우큐폰 상태 수정 -->
	<update id="updateCoupon" parameterType="java.util.Map">
	UPDATE COUPON SET COU_DELFLAG ='N' WHERE COU_CODE =#{cou_code}
	</update>
	
	<!-- 마일리지 사용 결제시 보유마일리지 상태 수정  -->
	<update id="updateMileage" parameterType="java.util.Map">
	UPDATE TRAINEE SET TRA_MILAGE = TRA_MILAGE-#{useMilage} WHERE TRA_ID =#{tra_id}
	</update>
	
	<!-- 결제 상세조회 -->
	<select id="getPayDetail" parameterType="java.util.Map" resultType="PayVo">
	SELECT PAY_NUM,
		PAY_TRA_BUYER,
		PAY_CLA_NUM, 
		PAY_PRICE, 
		PAY_METHOD, 
		PAY_PG, 
		PAY_STATUS, 
		PAY_DATE, 
		PAY_CONTENT, 
		PAY_RAW, 
		PAY_DISCOUNT, 
		PAY_CANDATE,
		PAY_CANCATE, 
		PAY_CANCONTENT, 
		PAY_UCOUNUM, 
		PAY_UMILAGE
		FROM PAY
		WHERE PAY_NUM=#{pay_num}
	</select>
</mapper>
